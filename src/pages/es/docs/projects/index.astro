---
import CardProject from "@/components/CardProject.astro";
import DocsLayout from "@/layouts/DocsLayout.astro";
import { getCollection } from 'astro:content';
import { useLocale } from "@/i18n/context";

const lang = useLocale(Astro)

// Get all projects from the collection
const allProjects = await getCollection('projects', (entry) => entry.id.split('/')[0] === lang );

// Separate featured and regular projects
const featuredProjects = allProjects.filter(project => project.data.featured);
const regularProjects = allProjects.filter(project => !project.data.featured);

// Sort by priority (highest to lowest) and then by date
const sortedFeaturedProjects = featuredProjects.sort((a, b) => {
    if (a.data.priority !== b.data.priority) {
        return b.data.priority - a.data.priority;
    }
    return b.data.date.getTime() - a.data.date.getTime();
});

const sortedRegularProjects = regularProjects.sort((a, b) => {
    if (a.data.priority !== b.data.priority) {
        return b.data.priority - a.data.priority;
    }
    return b.data.date.getTime() - a.data.date.getTime();
});

---

<DocsLayout>
    <div class="w-full overflow-x-hidden">
        <h1 class="text-3xl font-bold mb-8">
            Proyectos
        </h1>
        
        {sortedFeaturedProjects.length > 0 && (
            <section class="mb-12">
                <h2 class="text-2xl font-semibold mb-6">
                    Proyectos Destacados
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-[repeat(auto-fill,minmax(335px,1fr))] gap-6">
                    {sortedFeaturedProjects.map((project) => (
                        <CardProject project={project} />
                    ))}
                </div>
            </section>
        )}

        {sortedRegularProjects.length > 0 && (
            <section>
                <h2 class="text-2xl font-semibold mb-6">
                    Otros Proyectos
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {sortedRegularProjects.map((project) => (
                        <CardProject project={project} />
                    ))}
                </div>
            </section>
        )}

        {allProjects.length === 0 && (
            <div class="text-center py-12">
                <p class="text-gray-600 dark:text-gray-400">
                    No hay proyectos disponibles en este momento.
                </p>
            </div>
        )}
    </div>
</DocsLayout>
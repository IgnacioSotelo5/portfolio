---
import type { CollectionEntry } from 'astro:content';
import ExternalLink from '~/icons/external-link';
import Github from '~/icons/github';
import TechLogo from './TechLogo.astro';
import { useLocale } from '@/i18n/context';

interface Props {
    project: CollectionEntry<'projects'>;
}

const { project }: Props = Astro.props;
const { title, shortDescription, description, tech, repositories, demo, website, image, category, status, tags } = project.data;

const lang = useLocale(Astro);

---
    <div class="group relative flex flex-col overflow-hidden rounded-lg border border-edge dark:border-transparent dark:hover:border-action-primary/20 bg-surface-card transition-all hover:border-divider hover:shadow-lg">
      <span class="absolute -top-[1.2px] right-0 z-10">
        {
          status === 'completed' ? (
            <span class="inline-flex items-center gap-2 rounded-sm bg-action-primary/70 px-2 py-1 text-xs font-semibold rounded-tr-lg text-typography-main dark:text-white">Completed</span>
          ) : (
            <span class="inline-flex items-center gap-2 rounded-sm bg-action-secondary/70 px-2 py-1 text-xs font-semibold rounded-tr-lg text-typography-main dark:text-white">In Progress</span>
          )
        }
      </span>
      <div class="relative w-full overflow-hidden bg-surface-elevated">
        <img
          src={image || "/placeholder.svg"}
          alt={title}
          class="h-full w-full aspect-[4/3] object-cover transition-transform duration-300 group-hover:scale-105"
        />
      </div>

      <div class="flex flex-1 flex-col p-6 gap-y-3">
        <h3 class="text-lg font-semibold text-typography-main">{title}</h3>
        <p class="flex-1 text-sm text-typography-muted">{shortDescription}</p>
        
        <div class="flex flex-wrap gap-2">
          {
            tech.slice(0, 6).map((tech, index) => (
              <span
                class="inline-flex items-center gap-2 rounded-sm bg-surface-elevated px-2 py-1 text-xs font-medium text-typography-secondary"
              >

                <TechLogo name={tech} />
                {tech}
              </span>
            ))
          }
          {tech.length > 6 && (
            <span
              class="inline-flex items-center gap-2 rounded-sm bg-surface-elevated px-2 py-1 text-xs font-medium text-typography-muted"
            >
              +{tech.length - 6}
            </span>
          )}
        </div>

        <div class="flex gap-2 mt-2">
          <a
            href={repositories.find(repo => repo.type === 'frontend')?.url}
            target="_blank"
            rel="noopener noreferrer"
            class="flex items-center gap-2 rounded-md bg-surface-elevated px-3 py-2 text-sm font-medium text-typography-main transition-colors hover:bg-action-accent hover:text-typography-inverse"
            title="UI Repository"
          >
            <Github size={16} />
            <span class="hidden sm:inline">UI</span>
          </a>
          <a
            href={project.data.repositories.find(repo => repo.type === 'backend')?.url}
            target="_blank"
            rel="noopener noreferrer"
            class="flex items-center gap-2 rounded-md bg-surface-elevated px-3 py-2 text-sm font-medium text-typography-main transition-colors hover:bg-action-accent hover:text-typography-inverse"
            title="Backend Repository"
          >
            <Github size={16} />
            <span class="hidden sm:inline">Backend</span>
          </a>
        </div>

        <a
          href={`/docs/projects/${project.id.split('/')[1]}`}
          class="mt-2 inline-flex items-center justify-center gap-2 rounded-md bg-action-primary px-4 py-2 text-sm font-semibold text-typography-main transition-colors hover:opacity-90"
        >
          View Project
          <ExternalLink class="h-4 w-4" />
        </a>
      </div>
    </div>